.report_view

  %h1= @opts[:title]
  %h3 NumericTimeseries Report

  %ul.ui_tabs.toplgauge_tabs
    %li.active.overview
      %a(href="#" onclick="toplgaugeDisplayOverview();") Overview
    %li.distribution
      %a(href="#" onclick="toplgaugeDisplayDistribution();") Distribution


  .headbar
    %h2= @opts[:title]

  .widget_toplist.ui_sidebar_toplist(style="width:600px;")
    .ui_toplist
      .toplist_item
        .title /matches
        .value 36
        .percent 73.5%


  %div.toplgauge_keysearch(style="display:none;")
    .headbar
      %h2 Search for a #{key_nouns.first}
    %div(style="margin:16px;")
      here be dragons


  .toplgauge_tab.overview
    %div.toplgauge_widget_topx_timeline
    %div.toplgauge_widget_topx_toplist


  .toplgauge_tab.per_key(style="display:none;")
    %div.toplgauge_widget_perkey_timeline


  .toplgauge_tab.distribution(style="display:none;")
    %div.toplgauge_widget_topx_distribution

:javascript

  function toplgaugeDisplayOverview(){
    $(".toplgauge_tab").hide().filter(".overview").show();
    $(".toplgauge_tabs li").removeClass('active').filter(".overview").addClass('active');
    $(".toplgauge_widget_topx_timeline").show();
    $(".toplgauge_keysearch").hide();
    $(".toplgauge_widget_topx_toplist").show();
  }

  function toplgaugeDisplayDistribution(){
    $(".toplgauge_tab").hide().filter(".distribution").show();
    $(".toplgauge_tabs li").removeClass('active').filter(".distribution").addClass('active');
    $(".toplgauge_widget_topx_distribution").html("");

    $(".toplgauge_keysearch").hide();
      FnordMetric.widgets.barsWidget().render({
      elem: $(".toplgauge_widget_topx_distribution"),
      gauges: ["#{name}++count"],
      gauge_titles: {"#{name}++count": "Fnord"},
      title: "#{key_nouns.first} Distribution"
    });
  }


  function toplgaugeDisplayPerKeyOverview(){
    $(".toplgauge_tabs li").removeClass('active').filter(".per_key").addClass('active');
    $(".toplgauge_tab").hide().filter(".overview").show();
    $(".toplgauge_widget_topx_timeline").hide();
    $(".toplgauge_keysearch").show();
    $(".toplgauge_widget_topx_toplist").show();
  }

  function toplgaugeDisplayPerKey(key){
    $('.toplgauge_widget_perkey_timeline').html('');
    $(".toplgauge_tabs li").removeClass('active').filter(".per_key").addClass('active');
    $(".toplgauge_tab").hide().filter(".per_key").show();
    $(".toplgauge_keysearch").hide();

    
    var _gkey = "#{name}++series-"+key;
    var _gtitles = {};
    _gtitles[_gkey] = key;

    FnordMetric.widgets.timelineWidget().render({
      elem: $(".toplgauge_widget_perkey_timeline"),
      gauges: [_gkey],
      gauge_titles: _gtitles,
      title: "#{key_nouns.first}: " + key
    });
  }

  $('.toplgauge_tabs').bind('open_tab.per-key', function(o, a){
    toplgaugeDisplayPerKey(a);
  });


  